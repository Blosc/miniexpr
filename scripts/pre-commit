#!/bin/sh
#
# Pre-commit hook to check for trailing whitespace
# and prevent commits with trailing spaces in source files
#

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Check for trailing whitespace in staged files
files_with_trailing=$(git diff --cached --name-only --diff-filter=ACM | \
    grep -E '\.(c|h|md)$' | \
    xargs grep -l ' $' 2>/dev/null)

if [ -n "$files_with_trailing" ]; then
    echo "${RED}Error: Trailing whitespace detected in:${NC}"
    echo "$files_with_trailing" | sed 's/^/  /'
    echo ""
    echo "${YELLOW}To fix, run:${NC}"
    echo "  find . -type f \\( -name '*.c' -o -name '*.h' -o -name '*.md' \\) -exec sed -i '' 's/[[:space:]]*\$//' {} \\;"
    echo ""
    echo "${YELLOW}Or to commit anyway (not recommended):${NC}"
    echo "  git commit --no-verify"
    exit 1
fi

echo "${GREEN}âœ“ No trailing whitespace detected${NC}"
exit 0
